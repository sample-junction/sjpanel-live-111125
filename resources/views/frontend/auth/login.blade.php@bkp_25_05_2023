@extends('frontend.layouts.app')

@section('title', app_name() . ' | '.__('labels.frontend.auth.login_box_title'))
<style>
    .container-login100 {
        width: 100%;
        min-height: 100vh;
        display: -webkit-box;
        display: -webkit-flex;
        display: -moz-box;
        display: -ms-flexbox;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        padding: 15px;
        background-position: center;
        background-size: cover;
        background-repeat: no-repeat;
        background-image: url("/img/bg-01.jpg");
    }
    .white, .white > a{
        color:white;
    }
    .field-icon {
  float: left;
  margin-left: 303px;
  margin-top: -23px;
  position: relative;
  z-index: 2;
}
</style>

@section('content')
    <div class="row">
            <div class="wrapper wrapper-content animated fadeInRight container-login100">
                <div class="loginColumns animated fadeInDown">
                    <div class="row">
                        @include('includes.partials.messages')
                        <div class="col-md-6">
                            <h2 class="font-bold white">{{__('frontend.login.static.title')}}</h2>
                            <p class="white">{{__('frontend.login.static.subtitle')}}</p>
                            <div class="row">
                                <div class="col-12 col-md-12">
                                    <div class="text-center white">
                                        {!! $socialiteLinks !!}
                                    </div>
                                </div><!--/ .col -->
                            </div><!-- / .row -->
                        </div>
                        <div class="col-md-6">
                            <div class="ibox-content">
                                {{ html()->form('POST', route('frontend.auth.login.post'))->attribute('autocomplete="off"')->class('login_form')->open() }}
                                <div class="row">
                                   
                                    <div class="col-12 col-md-12">
                                        <div class="form-group">
                                            <input type="email" name="email" id="email"  maxlength="191" required="required" autocomplete="off" class="form-control" @if(Cookie::has('email')) value="{{Cookie::get('email')}}" @endif>
                                            <label class="form-control-placeholder" for="email" >

                                            {{__('validation.attributes.frontend.email')}}</label>
                                        </div>
                                    </div>
                                    {{--<div class="col-12 col-md-12">
                                        <div class="form-group">
                                            {{ html()->label(__('validation.attributes.frontend.email'))->for('email') }}

                                            {{ html()->email('email')
                                                ->class('form-control')
                                                ->placeholder(__('validation.attributes.frontend.email'))
                                                ->attribute('maxlength', 191)
                                                ->required() }}
                                        </div><!--form-group-->
                                    </div><!--col-->--}}
                                </div><!--row-->

                                <div class="row">
                                    <div class="col-12 col-md-12 mx-auto">
                                        <div class="form-group">
                                            <input type="password" name="password" id="password" required="required" autocomplete="off" class="form-control" @if(Cookie::has('password')) value="{{Cookie::get('password')}}" @endif>

                                            <label class="form-control-placeholder" for="password">{{__('validation.attributes.frontend.password')}}</label>
                                            <span toggle="#password" class="fa fa-fw fa-eye-slash field-icon toggle-password"></span>
                                            <!--i class="far fa-eye" id="togglePassword" style="margin-left: 306px; cursor: pointer;margin-top: -23px;"></i-->

                                        </div>
                                    </div>
                                    {{--<div class="col-12 col-md-12">
                                        <div class="form-group">
                                            {{ html()->label(__('validation.attributes.frontend.password'))->for('password') }}

                                            {{ html()->password('password')
                                                ->class('form-control')
                                                ->placeholder(__('validation.attributes.frontend.password'))
                                                ->required() }}


                                        </div><!--form-group-->
                                    </div><!--col-->--}}
                                </div><!--row-->

                                <div class="row">
                                    <div class="col-12 col-md-12">
                                        <div class="form-group">
                                            <div class="checkbox">
                                                {{ html()->label(html()->checkbox('remember', false, 1) . ' ' . __('labels.frontend.auth.remember_me'))->for('remember') }}
                                            </div>
                                        </div><!--form-group-->
                                    </div><!--col-->
                                </div><!--row-->

                                <div class="row">
                                    <div class="col-12 col-md-12">
                                        <div class="form-group clearfix">
                                            {{ form_submit(__('labels.frontend.auth.login_button')) }}
                                        </div><!--form-group-->
                                    </div><!--col-->
                                </div><!--row-->

                                <div class="row">
                                    <div class="col-12 col-md-12">
                                        <div class="form-group text-right">
                                            <a href="{{ route('frontend.auth.password.reset') }}">{{ __('labels.frontend.passwords.forgot_password') }}</a>
                                        </div><!--form-group-->
                                    </div><!--col-->
                                </div><!--row-->
                                 <input type="hidden" id="requestid" name="rid" value="{{$uuid}}" />
                                <input type="hidden" id="eventid" name="eid" value="{{$ip}}" />
                                <input type="hidden" id="cc" value="{{$country_code}}" />
                                <input type="hidden" id="dfiq_check" name="dfiq_check" value="{{$dfiq}}">
                                {{ html()->form()->close() }}

                               {{--<p class="m-t">
                                    <small>{{__('frontend.login.static.footer_title_1')}} &reg; 2018</small>
                                </p>--}}
                            </div>
                        </div>
                    </div>
                    <hr/>
                    @include('frontend.cms.page.cms_footer')

                    
                </div>

            </div>
    </div>
@endsection

@push('after-styles')
    <style>

        .form-group {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .form-control-placeholder {
            position: absolute;
            top: 0;
            padding: 7px 0 0 13px;
            transition: all 200ms;
            opacity: 0.5;
        }

        .form-control:focus + .form-control-placeholder,
        .form-control:valid + .form-control-placeholder, .form-control + .form-control-placeholder {
            font-size: 75%;
            transform: translate3d(0, -100%, 0);
            opacity: 1;
        }

    </style>
    @push('after-scripts')
    <script type="text/javascript" id="forensic_script_id" src="https://api-cdn.dfiq.net/scripts/forensic-v5.0.0.min.js" data-key="29109E607D0B6E11DE0B966F50EA617A-5004-1"></script>
    <script>
        $(document).on('click',".toggle-password",function() {

  $(this).toggleClass("fa-eye fa-eye-slash");
  var input = $($(this).attr("toggle"));
  if (input.attr("type") == "password") {
    input.attr("type", "text");
  } else {
    input.attr("type", "password");
  }
});
   
        $(document).ready(function() {
            
          
    var flag = 0;
    var msg = '';
    $('.login_form .form-control').blur(function() {

        var info = $(this).val();
        var id = $(this).attr('id');
        var dfiq_check=$("#dfiq_check").val();
                                        
        if(id == 'email'){
            if(flag==0 && dfiq_check==1){
            if(info!=''){
            invokeAPI(info);
        } 
            }
        }
    })
/*    const togglePassword = document.querySelector('#togglePassword');
  const password = document.querySelector('#password');
    togglePassword.addEventListener('click', function (e) {
        console.log("click");

    // toggle the type attribute
    const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
    password.setAttribute('type', type);
    // toggle the eye slash icon
    this.classList.toggle('fa-eye-slash');
})*/
});
    function invokeAPI(info) {
                var req = document.getElementById("requestid").value;
                var event = document.getElementById("eventid").value;
                var country = document.getElementById("cc").value;
                var utm_source="SjPanelLogin";
                //$('#form-dispaly').hide();
               // $('.loader').show();
                var uniquenessParam = Forensic.createUniquenessParam(event,null, false);
                var geoParam = Forensic.createGeoParam(country);
                Forensic.forensic(req, successCallback, errorCallback, uniquenessParam, geoParam, null, null, utm_source);
            }
             function successCallback(jsonData) {
                var FlagStatus=false;
                var Message='';
                console.log(jsonData);
               // $('#form-dispaly').hide();
               // $('.loader').show();
                /*$.ajaxSetup({
                headers: {
                 'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
                });*/
                var email=$('#email').val();
                var ip_address=$('#eventid').val();
                var panelistId=$('#eventid').val();
                $.ajax({
                    url: "{{ route('frontend.auth.register.dfiqData.post') }}",
                    type: 'GET',
                    data: {datajsondata:jsonData,email:email,ip_address:ip_address,panelistId:panelistId,user_id:''},
                    success: function(response){
                       // window.location=addressBar+"&DFIQ=true";
                    }, 
                    async: true
                    });

                if (jsonData.forensic.marker.score > 26){
                    console.log("fraud score >= 25 or not unique"); // Add your logic to handle non-fraud/unique

                    if(jsonData.forensic.marker.isAnonymous == true  && FlagStatus==false){
                        Message="VPN/Proxy detected. Please login without VPN to access your account.";
                        FlagStatus=true;
                    }
                    
                }
                if(FlagStatus==true){
                    setTimeout(function() {
                                toastr.error(Message, '' );
                                }, 400);
                    $('.btn').attr('disabled','true');
                 }else{
                   // $('.btn').attr('disabled','false');
                 }
            };
            function errorCallback(jsonData) {
                console.log(jsonData.error.message); // Add your logic to handle errors
            }
</script>

@endpush

