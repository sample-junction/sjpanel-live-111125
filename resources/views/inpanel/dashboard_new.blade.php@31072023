@extends('inpanel.layouts.device')

@push('after-styles')

<link href="{{asset('css2/dashboard_style.css')}}" rel="stylesheet"> 
    <link href="{{asset('vendor/css/plugins/c3/c3.min.css')}}" rel="stylesheet">
    <link href="https://afeld.github.io/emoji-css/emoji.css" rel="stylesheet">
    <style type="text/css">
        #line_spc{
                border-left: 1px solid #ECECEC;
    display: inline-block;
    height: 270px !important;
    /* padding-left: 28px !important; */
    margin-left: 18px !important;
    position: absolute;
        }
        #H_r{
            display: none;
        }
        @media(min-width: 220px) and (max-width:990px){
            #H_r{
                display: block !important;
                margin-top: 0px !important;
            }
        }
		.cst-full-sr{
            border: 1px solid #ECECEC;
        }

        .cst-full-sr:hover{
            border: 1px solid #794dc8 !important;
            box-shadow: rgba(149, 157, 165, 0.2) 0px 8px 24px;
        }
			
    </style>

@endpush

@section('dashboard_select','cst-active')
@section('content')





<!-- New -->


<div class="row text-center d-sm-none ">

    <div class="col-12 mt-4">


        <div class="position-relative" style="width: 100%">
            <img src="img/search-icon.png" alt="img" width="10px" id="searchIconM" class="img-fluid position-absolute" style="left: 20px; top: calc(50% - 10px/2 - 1px); opacity: 0.7">
            <input type="text" name="search" value="" placeholder="       {{__('inpanel.invite.myreferrals.index.search')}}" id="searchBarM" class="p-2 rounded" style="width:100%; border: 1px solid #F4F4F4;">
        </div>


    </div>

</div>

                         <input type="hidden" id="user_id" name="user_id" value="{{$user->id}}" />
                        <input type="hidden" id="requestid" name="rid" value="{{$user->uuid}}" />
                        <input type="hidden" id="email" name="email" value="{{$user->email}}" />
                        <input type="hidden" id="eventid" name="eid" value="{{str_replace('.','-',$user->ip_registered_with)}}" />
                        <input type="hidden" id="cc" value="{{$user->country_code}}" />
                        <input type="hidden" id="home_country" value="{{$user->home_country}}" />
                        <input type="hidden" id="dfiq_check" name="dfiq_check" value="{{$dfiq}}">

<!-- <div class="alert alert-warning logged-in-as mb-0">
        You are currently logged in as {{ Auth::user()->name }}. <a href="https://test17.sjpanel.com/admin/auth/user/{{$user->id}}/login-as">Re-Login as {{ Auth::user()->name }}</a>.
</div> -->
<div class="p-3 rounded">

    <div class="row rounded mt-1 mt-lg-4 p-3 bg-white" style="border-radius: 10px;" id="top_user_info">

        <div class="col-12 col-md-4 text-center text-md-start">
    
            <img @if(Auth::user()->image_url) src="{{asset("img/".Auth::user()->image_url)}}" @else  src="{{asset("vendor/img/rewards/profile_default.png")}}" @endif  class="img-fluid me-3 mb-1" alt="" style="height:45px;width:45px;object-fit:cover;scale:1.3; border-radius:32px!important; " alt="img" >  <span class="lead d-none d-md-inline-block">{{__('inpanel.dashboard.user.name')}}</span>  <span class="lead fw-bold d-none d-md-inline-block" style="text-transform: capitalize;" id="user_first_name_tab">{{ Auth::user()->first_name }} !</span>
    
            <p class="lead d-sm-none mt-2 mb-1">{{__('inpanel.dashboard.user.name')}} <span class="fw-bold">{{ Auth::user()->first_name }}!</span> </p>

        </div>
    
         
        <div class="col-12 col-md-8 text-center text-md-end mt-1"> 
    
            <span class="d-none d-md-inline-block"><small>{{__('inpanel.dashboard.user.panId')}} </small><span class="fw-bold">{{ Auth::user()->panellist_id }}</span> <span class="ms-2 me-2">|</span> <span class="fw-bold">{{ Auth::user()->country}}</span>  <span class="ms-2 me-2">|</span></span>
    
            <p class="d-sm-none m-1">{{__('inpanel.dashboard.user.panId')}}. <span class="fw-bold">{{ Auth::user()->panellist_id }} | {{ Auth::user()->country}}</span></p>
             
                                
            <span class="text-primary"> <a href="@if(Route::has('inpanel.profiler.show')){{ route('inpanel.profiler.show') }}@endif">{{__('inpanel.dashboard.user.pro_completed')}} @if(isset($profilePercent)){{$profilePercent}}@else{{0}}@endif%</a> </span>
            
        </div>
    
    </div>

</div>








<div class="row mt-3 mb-2">


    <div class="col">

        <p class="h4 ms-2" style="font-weight: 600;">{{__('inpanel.dashboard.heading')}}</p>

    </div>


</div>


<div class="shadow p-3 rounded bg-white" style="border-radius: 10px;padding-top: 25px !important;">

    <div class="row mt-1">
@php
$spanishArr=['5da78cda894794269f063c23'=>'Mi perfil','5da78cda894794269f063c25'=>'Automotor','5da78cda894794269f063c26'=>'Empleo','5da78cda894794269f063c27'=>'Viajes / Ocio','5da78cda894794269f063c29'=>'Comida saludable','5da78cda894794269f063c2a'=>'TecnologÃ­a','5da78cda894794269f063c24'=>'Familia','5da78cda894794269f063c28'=>'Internet / Juegos / Deportes'];
                            if($detailed_profile_survey){
                            $detailed_profile_count = 1;
                            $detailedProfileComplete = 0;
                            }else{
                            $detailed_profile_count = 0;
                            $detailedProfileComplete = 1;
                            }
                            $total_surveys  = $allUserSurveys->count()+1;
                            $active_surveys  = $active_user_count;
                            $completed_surveys  = $completedSurveys->count()+$detailedProfileComplete;
                            $attemptedSurvey  = $user_count;
                            $expiredSurvey  = $userExpireSurveys->count();
                        @endphp

        <div class="col-12 col-lg-3 pt-3 cst-border-first-sec">


            <div class="row">


                <div class="col">

                    <span class="h3 ps-3 pe-3 pt-2 pb-2" style="background: #dcd5ff; color: #7465F1; font-weight: 700; border-radius: 15px;padding-left: 22px !important;padding-right: 22px !important;margin-left: 5px;">
                    @if( isset($profile_sections_all)) 
                        {{count($profile_sections_all)+count($surveys)+count($hsurveys)}}
                        
                    @else{{'0'}}@endif
                    </span>

                    

                </div>
                @php
                    $live_survey_points = 0;
                    $approved_survey_points = 0;
                    $assigned_points = 0;
                    $approved_incentive = 0;
                    $approved_count = 0;
                    $hsurvey_points = 0;
                        if(!empty($surveys)){
                        foreach($surveys as $live_survey){
                            $live_survey_points += $live_survey->points;
                        }
                    }
                    if(!empty($profile_sections_all)){
                        foreach($profile_sections_all as $profile_survey){
                            $assigned_points += $profile_survey->points;
                        }
                    }
                    if(count($hsurveys)){
                        foreach($hsurveys as $survey_with_approved_incentive){
                            $hsurvey_points += $survey_with_approved_incentive->points;
                            if($survey_with_approved_incentive->status === 50){
                                $approved_incentive += $survey_with_approved_incentive->points;
                                $approved_count++;
                            }
                        }
                    }
                @endphp
                <div class="col text-end">
                    
                    <p style="transform: translate(-5px,-10px); font-weight: 600; font-size: 14px;margin-top: 5px;">
                    $@if( isset($user_awaited_points)) 
                        {{--$user_awaited_points/1000 + $detailed_profile_survey->total_points/1000 + $live_survey_points*config('app.points.metric.conversion')--}}
                        {{($assigned_points + $live_survey_points + $hsurvey_points)*config('app.points.metric.conversion')}}
                    @else
                        {{'0'}}
                    @endif {{__('inpanel.dashboard.user.assiagn')}}</p>

                    <!-- <p style="transform: translate(-5px,-10px); font-weight: 600; font-size: 14px;margin-top: 5px;">$@if( isset($availableProfilesCount)) {{$availableProfilesCount / 10}}@else{{'0'}}@endif {{__('inpanel.dashboard.user.await')}}</p> -->

                </div>
                <span><p class="pt-4 ms-1" style="font-size: 20px; font-weight: 300;">{{__('inpanel.dashboard.assigned')}}</p></span>

            </div>
            <hr id="H_r">

        </div>






        <div class="col-12 col-lg-3 pt-4 pt-lg-3 cst-border-first-sec">


            <div class="row">


                <div class="col">

                    <span class="h3 ps-3 pe-3 pt-2 pb-2" style="background: #e8f8f2; color: #53E0A3; font-weight: 700; border-radius: 15px;padding-left: 22px !important;padding-right: 22px !important;margin-left: 5px;">
                    @if( isset($completedProfiles)){{count($completedProfiles) + $approved_count}}@else{{0}}@endif
                    </span>

                    

                </div>

                <div class="col text-end">

                    @php
                        $points = (!empty($global_user_points->user_points))?$global_user_points->user_points['completed']:0;
                        $completed_points = 0;
                        if(count($completedProfiles)){
                            foreach($completedProfiles as $pro_sur_taken){
                                $completed_points += $pro_sur_taken->points;
                            }
                        }
                        
                    @endphp
                    {{-- <i class="fas fa-trophy"></i> --}}{{--__('inpanel.nav.sidebar_points', ['user_points' => $points])--}} 
                        <p style="transform: translate(-5px,-10px); font-weight: 600; font-size: 14px;margin-top: 5px;">
                        {{-- $@if( isset($user_point)) {{$user_point/1000}}@else{{'0'}}@endif  --}}
                        ${{($completed_points + $approved_incentive)*config('app.points.metric.conversion')}}
                        {{__('inpanel.dashboard.user.earn')}}</p>
               

                </div>

                <span><p class="pt-4 ms-1" style="font-size: 20px; font-weight: 300;">{{__('inpanel.dashboard.completed_surveys')}}</p></span>
            </div>
            <hr id="H_r">

        </div>







        <div class="col-12 col-lg-3 pt-4 pt-lg-3 cst-border-first-sec">


            <div class="row">


                <div class="col">

                    <span class="h3 ps-3 pe-3 pt-2 pb-2" style="background: #e9f4fe; color: #71B6F6; font-weight: 700; border-radius: 15px;padding-left: 22px !important;padding-right: 22px !important;margin-left: 5px;">
                    @if( isset($pendingProfilecount_v1)){{$pendingProfilecount_v1 + count($surveys)}}@else{{0}}@endif</span>

                   

                </div>

                <div class="col text-end">

                    <p style="transform: translate(-5px,-10px); font-weight: 600; font-size: 14px;margin-top: 5px;">
                    $@if( isset($user_awaited_points)) {{$user_awaited_points + $detailed_profile_survey->total_points/1000 + $live_survey_points*config('app.points.metric.conversion')}}
                    @else{{'0'}}
                    @endif {{__('inpanel.dashboard.user.await')}}</p>

                </div>
                <span> <p class="pt-4 ms-1" style="font-size: 20px; font-weight: 300;">{{__('inpanel.dashboard.available')}}</p></span>

            </div>
            <hr id="H_r">


        </div>







        <div class="col-12 col-lg-3 pt-4 pt-lg-3 cst-first-sec">


            <div class="row">


                <div class="col">

                    <span class="h3 ps-3 pe-3 pt-2 pb-2"  style="background: #fee6e7; color: #F4797E; font-weight: 700; border-radius: 15px;padding-left: 22px !important;padding-right: 22px !important;margin-left: 5px;">@if( isset($allUserSurveys)){{$expiredSurvey}}@else{{0}}@endif</span>

                    

                </div>

                <div class="col text-end">

                    <p style="transform: translate(-5px,-10px); font-weight: 600; font-size: 14px;margin-top: 5px;">$@if( isset($user_missed_points)) {{$user_missed_points/1000}}@else{{'0'}}@endif {{__('inpanel.dashboard.user.miss_pt')}}</p>

                </div>

                <span><p class="pt-4 ms-1" style="font-size: 20px; font-weight: 300;">{{__('inpanel.dashboard.expired_surveys')}}</p></span>
            </div>


        </div>


    </div>

</div>













<div class="row mt-5">


    <div class="col mt-1">

        <p class="h4 ms-2 mb-0" style="font-weight:600">{{__('inpanel.dashboard.user.hot_surveys')}}</p>

    </div>


    <div class="col text-end">

        <a href="@if(Route::has('inpanel.survey.index')){{ route('inpanel.survey.index') }}@endif" >{{__('inpanel.dashboard.user.view_all')}}</a>

    </div>



</div>




<div class="row mt-1 p-lg-3">


    <div class="col cst-bg-hot-survey" style="border-radius: 10px;">
<!-- @if(isset($allUserSurveys) || isset($detailed_profile_survey))
                            @php
                                if($detailed_profile_survey){
                                $detailed_profile_count = 1;
                                }else{
                                $detailed_profile_count = 0;
                                }
                                $total_surveys  = $userActiveSurveys->count()+$detailed_profile_count;
                            @endphp
                            {{__('inpanel.dashboard.user.available_surveys_notifications',
                                ['active_survey' => $total_surveys, 'notification' => '0'])
                            }}
                        @else
                            {{__('inpanel.dashboard.user.available_surveys_notifications',
                                ['active_survey' => "0", 'notification' => '0'])
                            }}
                        @endif -->

        <div class="row pt-lg-4 pb-lg-3 pe-lg-3 ps-lg-3" style="background: #EFEDFF !important;padding-top: 15px !important;padding-bottom: 30px !important;border-radius: 12px;" id="hot_Surveys_Section">


@foreach($profile_sections as $key=> $detailed_profile_survey)
@php
if($key % 3 == 0 && $key != 0){
echo "<div class='row mt-2 mb-2 d-none d-lg-block' style='margin-bottom: -10px !important;'>";
echo    "<div class='col' style='margin-left:12px'>";
echo      "<hr style='scale:1.02; opacity:0.1'>";
echo    "</div>";

echo "</div>";
}
 @endphp

            <div class="col-12 col-lg-4 mt-3 ">
                 
                <div class="border p-3 rounded bg-white cst-full-sr">


                    <div class="row">

                        <div class="col">

                            <p class="h4 mb-0" style="font-weight: 600; color:#005A9A">{{$detailed_profile_survey->points}} {{__('inpanel.survey.index.column_2')}}</p>

                        </div>

                        
                        <div class="col text-end">

                            <p class="fw-bold lead">${{$detailed_profile_survey->points*config('app.points.metric.conversion')}}</p>

                        </div>

                    </div>



                    <div class="row" style="transform: translateY(-5px);">

                        <div class="col">

                            <p class="lead">@if(auth()->user()->locale=='es_US'){{$spanishArr[$detailed_profile_survey->_id]}} @else {{$detailed_profile_survey->display_name}} @endif</p>

                        </div>

                    </div>




                    <div class="row">

                        <div class="col">

                            <span class="p-2 rounded-pill" style="color:#7465F1; background: #f3f2f2; font-size: 12px;">{{$detailed_profile_survey->completion_time}} {{__('min.')}}</span>

                            <br>

                            <p class="pt-1" style="font-size: 12px; transform: translateY(10px);">{{__('inpanel.dashboard.survey.column_2')}}</p>

                        </div>

                        
                        <div class="col text-end">

                            <!-- <button class="btn btn-primary btn-lg" style="font-size: 18px;" ><a  class="btn btn-primary" href="@if(Route::has('inpanel.survey.execute.show')){{route('inpanel.profiler.single.show', $detailed_profile_survey->_id)}}@endif"  >Take Survey </a></button> -->

                            <span class="pull-right survey_list">
                                    
                                    <a  class="btn btn-primary btn-lg" style="font-size:18px" href="@if(Route::has('inpanel.survey.execute.show')){{route('inpanel.profiler.single.show', $detailed_profile_survey->_id)}}@endif" id="tke_sry_but">{{__('inpanel.survey.index.link_take_survey')}}</a>
                                  
                                </span>

                        </div>

                    </div>


                </div>
               

            </div>
			
 @endforeach
  @if(count($user_assign_projects_info)>0)
 @php
 echo "<div class='row mt-2 mb-2 d-none d-lg-block' style='margin-bottom: -10px !important;'>";
echo    "<div class='col' style='margin-left:12px'>";
echo      "<hr style='scale:1.02; opacity:0.1'>";
echo    "</div>";

echo "</div>";
                        @endphp
                        @endif

 @if(count($user_assign_projects_info)>0)
                        @php $i=0;

                        @endphp
                        @foreach($user_assign_projects_info as $key=>$detailed_profile_survey1)
                            
                        @php

                        if($key % 3 == 0 && $key != 0){
                        echo "<div class='row mt-2 mb-2 d-none d-lg-block' style='margin-bottom: -10px !important;'>";
                        echo    "<div class='col' style='margin-left:12px'>";
                        echo      "<hr style='scale:1.02; opacity:0.1'>";
                        echo    "</div>";

                        echo "</div>";
                        }
                         @endphp

            <div class="col-12 col-lg-4 mt-3 ">
                 
                <div class="border p-3 rounded bg-white cst-full-sr">


                    <div class="row">

                        <div class="col">

                            <p class="h4 mb-0" style="font-weight: 600; color:#005A9A">{{$detailed_profile_survey1->points}} {{__('inpanel.survey.index.column_2')}}</p>

                        </div>

                        
                        <div class="col text-end">

                            <p class="fw-bold lead">${{$detailed_profile_survey1->points*config('app.points.metric.conversion')}}</p>

                        </div>

                    </div>



                    <div class="row" style="transform: translateY(-5px);">

                        <div class="col">

                            <p class="lead"> {{$detailed_profile_survey1->apace_project_code}}</p>

                        </div>

                    </div>




                    <div class="row">

                        <div class="col">

                            <span class="p-2 rounded-pill" style="color:#7465F1; background: #f3f2f2; font-size: 12px;">{{@$detailed_profile_survey1->loi}} {{__('min.')}}</span>

                            <br>

                            <p class="pt-1" style="font-size: 12px; transform: translateY(10px);">{{__('inpanel.dashboard.survey.column_2')}}</p>

                        </div>

                        
                        <div class="col text-end">

                            <!-- <button class="btn btn-primary btn-lg" style="font-size: 18px;" ><a  class="btn btn-primary" href="@if(Route::has('inpanel.survey.execute.show')){{route('inpanel.profiler.single.show', $detailed_profile_survey->_id)}}@endif"  >Take Survey </a></button> -->

                            <span class="pull-right survey_list">
                                    
                                    <a  class="btn btn-primary btn-lg" style="font-size:18px" href="@if(Route::has('inpanel.survey.execute.show')){{route('inpanel.survey.execute.show', ['user_project_id' => $detailed_profile_survey1->id])}}@endif" id="tke_sry_but">{{__('inpanel.survey.index.link_take_survey')}}</a>
                                  
                                </span>

                        </div>

                    </div>


                </div>
               

            </div>
            
 @endforeach
 @endif

 <!--<div class="row mt-2 mb-2 d-none d-lg-block"><div class="col ms-2 me-2"><hr></div></div> -->
        </div>
		<div class="row d-none d-lg-block">

            <div class="col ms-3 me-3">

                <!-- <hr> -->

            </div>

        </div>

    </div>


</div>
<!--last section-->

<div class="row mt-5 mb-md-3" style="margin-bottom: -27px !important;">






<!--for mobile-->

<div class="col-12 d-lg-none mb-5">

    <div class="shadow pt-4  pe-1 ps-1 pb-0 bg-white border" style="border-radius: 10px;">

        <p class="lead pe-3 ps-3" style="font-weight:600">{{__('inpanel.dashboard.detailed_progress')}}</p>

        <hr class="mb-5 me-3 ms-3">

        <div class="row">

            <div class="col d-flex justify-content-center">

                <div class="semi-donut margin cst-per" style="--percentage : @if(isset($profilePercent)){{$profilePercent}}@else{{0}}@endif; --fill: #8387FF ;color: #FFA40B;">
                    <span class="text text-warning fw-bold" id="percentText1" style="color: #FFA40B !important;margin-top: 15px;"></span>
                </div>


                </col>


            </div>


            <div class="row mt-2 mb-4">

                <div class="col lead text-center text-warning fw-bold" style="position: absolute;left: -124px;">0</div>

                <div class="col lead text-center text-success fw-bold " style="position: relative;right: -136px;">100</div>

            </div>

            <div class="row mt-3 mb-4 text-center ms-1">

                <p class="pb-1">{{__('inpanel.dashboard.profile.filling')}}</p>

            </div>


        </div>

    </div>

</div>
<!---->






<div class="col-12 col-lg-7">

<div class="shadow p-4 bg-white border" style="border-radius: 10px;">

<div class="row">

    <div class="col-7">
        <p class="lead" style="font-weight:600">{{__('inpanel.dashboard.recent_activites')}}</p>
    </div>

    <div class="col-5 text-end">
        <a href="{{ route('inpanel.reward.show') }}" class="">{{__('inpanel.dashboard.show_more_recent_activities')}}</a>
    </div>


</div>

<hr class="mt-0 mb-4">
@if(!empty($userActivities))
<div>
<ul style="list-style-type: none;"> 

    <!-- <div id="line_spc"></div> -->
            @php $i = 0; @endphp
                            @forelse($userActivities as $activity)
                             @if(!$activity->properties->isEmpty())
                                            @php
                                            
                                                $jsonData = json_decode($activity->properties);
                                                if(isset($jsonData->survey_code)){
                                                    $surveycode = $jsonData->survey_code;
                                                    $descriptionData = trans($activity->description,['code'=>$surveycode]);
                                                }else{
                                                    $descriptionData = trans($activity->description);
                                                }
                                            @endphp
                                        @else
                                            @php
                                            
                                                $descriptionData = trans(@$activity->description);
                                                
                                            @endphp    
                                        @endif
                                        {{--{{$activity->created_at->format('g:i a')}}--}}
                                        @if(!$activity->properties->isEmpty())
                                            @php
                                           
                                                $jsonData = json_decode($activity->properties);
                                                if(isset($jsonData->survey_code)){
                                                    $surveycode = $jsonData->survey_code;
                                                    $descriptionData = trans($activity->description,['code'=>$surveycode]);
                                                }else{
                                                    $descriptionData = trans($activity->description);
                                                }
                                            @endphp
                                        @else
                                            @php
                                           
                                                $descriptionData = trans($activity->description);
                                            @endphp    
                                        @endif
    <li class="mb-4 ">
     <div class="d-flex"> 
        <div class="col-2">
            <img src="img/clock img.png" style="display: inherit;" alt="img" class="me-1 position-relative">  
            @if($i < 3) 
            <span id="img_li"></span> 
            @endif
        </div> 
        <div class="col-10"> 
            <span class="fw-bold">{{$descriptionData}}</span> 
            <p class="mr-md-5" style="transform: translateY(7px); opacity:0.5" id="user_activity_para">{{$activity->created_at->diffForHumans()}}</p>
        </div> 
    </div> 
    
     </li>
    
@php $i++; @endphp
@empty

@endforelse
</ul>
</div>
@endif

</div>



</div>


<div class="col-5 d-none d-lg-block mt-3 mt-md-0">

    <div class="shadow pt-4  pe-4 ps-4 pb-0 bg-white border" style="border-radius: 10px;padding-bottom: 18px !important;">

        <p class="lead" style="font-weight:600">{{__('inpanel.dashboard.detailed_progress')}}</p>

        <hr class="mb-5">

        <div class="row">

            <div class="wrapper d-flex justify-content-center">
                <div class="circle-out">

                    <div id="bar" class="circle" data-progress="@if(isset($profilePercent)){{$profilePercent}}@else{{0}}@endif"  class="detailed_progress"></div>
                    <span class="text text-warning fw-bold" id="percentText" style="color: #FFA40B !important;"></span>
                </div>
            </div>


        </div>


        <div class="row mt-2 mb-4">

            <div class="col lead text-center text-warning fw-bold">0</div>

            <div class="col lead text-center text-success fw-bold">100</div>

        </div>

        <div class="row mt-3 mb-4 text-center">

            <p class="pb-1">{{__('inpanel.dashboard.profile.filling')}}</p>

        </div>


    </div>

</div>



@endsection


@push('after-scripts')
 <script src="{{asset('vendor/js/plugins/d3/d3.min.js')}}"></script>
    <script src="{{asset('vendor/js/plugins/c3/c3.min.js')}}"></script>
    <script type="text/javascript" id="forensic_script_id" src="https://api-cdn.dfiq.net/scripts/forensic-v4.0.0.min.js" data-key="29109E607D0B6E11DE0B966F50EA617A-5004-1" data-nc></script>
<script type="text/javascript" src="{{asset('js2/dashboard.js')}}"></script>
<script type="text/javascript">

        /*$(document).ready(function(){
            displayOtherCountryPopUp(); 
        })*/
         var dfiq_check=$("#dfiq_check").val();
         var home_country=$('#home_country').val();
         if(dfiq_check==1 && home_country==''){
                 invokeAPI(); 
                //displayOtherCountryPopUp();               
            }else{
                 if(home_country=='OUT'){
                 displayOtherCountryPopUp();    
                }           

            }
        @if($user->is_blacklist == 1)
           // displayBlacklistPopUp();
        @endif

        function  displayBlacklistPopUp()
        {
            swal({
                title: ''+"{{__('inpanel.dashboard.pop_up.title')}}",
                html: "{{__('inpanel.dashboard.pop_up.title_6')}}",
                type: "{{__('inpanel.dashboard.pop_up.title_5')}}",
                showCancelButton: false,
                confirmButtonColor: "#1080d0",
                confirmButtonText: "Ok",
                //cancelButtonText: "Cancel",
                closeOnConfirm: true
            }).then((result) => {
                // if (result.value===true) {
                //     window.location.href = "detailed-profile?update=profile";
                // } 
                // else if(result.dismiss == 'cancel') {
                    
                // }
            });
        }
        function  displayOtherCountryPopUp()
        {

            // $('.navbar-default').hide();
            swal({
                title: ''+"{{__('inpanel.dashboard.pop_up.title')}}",
                html: "{!!__('inpanel.dashboard.pop_up.title_7')!!}",
                type: "{{__('inpanel.dashboard.pop_up.title_5')}}",
                customClass: 'swal-wide',
                showCancelButton: false,
                confirmButtonColor: "#1080d0",
                confirmButtonText: "{{__('inpanel.dashboard.pop_up.title_9')}}",
                //cancelButtonText: "Cancel",
                closeOnConfirm: true
            }).then((result) => {
                
                 if (result.value===true) {
                    // window.location.href = "/dashboard";
                 } 
                 else if(result.value == undefined) {
                   // window.location.href = "/dashboard";
                 }
            });
        }

        $(document).ready(function(){
            var detailedMeter = $('#gauge').length;
            if(detailedMeter > 0){
                c3.generate({
                    bindto: '#gauge',
                    data:{
                        columns: [
                            [
                                'Progress', @if(isset($profilePercent)){{$profilePercent}}@else{{0}}@endif
                            ]
                        ],

                        type: 'gauge'
                    },
                    color:{
                        pattern: ['#1ab394', '#BABABA']

                    }
                });
            }

        });

        //graph
        const bar = document.getElementById("bar");

        var progress = bar.dataset.progress;

        var metertext = document.getElementById("percentText").innerHTML = progress + '%';
         var metertext1 = document.getElementById("percentText1").innerHTML = progress + '%';

        const p = 180 - (progress / 100) * 180;

        bar.style.transform = `rotate(-${p}deg)`;


                // const bar1 = document.getElementById("bar1");

        // var progress1 = bar1.dataset.progress;

       

        // const q = 180 - (progress1 / 100) * 180;

        // bar1.style.transform = `rotate(-${q}deg)`;
        //

        @if($tour_taken == 0)
        displayTourOption();
        @include('inpanel.includes.partials.php-js.dashboard')
        @endif
        function getCookie(cname) {
           
          let name = cname + "=";
          let decodedCookie = decodeURIComponent(document.cookie);
          let ca = decodedCookie.split(';');
          for(let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) == ' ') {
              c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
              return c.substring(name.length, c.length);
            }
          }
          return "";
        }
        function  displayTourOption()
        {
             if(getCookie("Tour")!=1){
            swal({
                title: ''+"{{__('inpanel.dashboard.pop_up.title')}}",
                html: "{{__('inpanel.dashboard.pop_up.title_1')}}" +
                    "<br/>{{__('inpanel.dashboard.pop_up.title_2')}}&nbsp;<i class='far fa-smile-wink'></i><br/>",
                type: "{{__('inpanel.dashboard.pop_up.title_5')}}",
                showCancelButton: true,
                confirmButtonColor: "#1080d0",
                confirmButtonText: "{!! __('inpanel.dashboard.pop_up.title_3') !!}",
                cancelButtonText: "{!! __('inpanel.dashboard.pop_up.donot_show_button') !!}",
                closeOnConfirm: false,
                footer: "<a href='javascript:void(0)' onclick='closeTour()' id='some-action'>{!! __('inpanel.dashboard.pop_up.skip_for_now') !!}</a>"
            }).then((result) => {
                if (result.value===true) {
                    shepherd.start();
                    //window.location.href = "@if(Route::has('inpanel.profiler.show')){{route('inpanel.profiler.show')}}@endif";
                    // For more information about handling dismissals please visit
                    // https://sweetalert2.github.io/#handling-dismissals
                } 
                else if(result.dismiss == 'cancel') {
                    changeTourOption();
                }
            });
        }
    }
         /*
            added code on 1 july 2022 via dushyant
            starts
            code is for show profile update popup every six month 
        */

        @if($minute == 0 && $user->is_blacklist == 0)
        displayProfilePopUp();
        @endif

        function  displayProfilePopUp()
        {
            swal({
                title: ''+"{{__('inpanel.dashboard.pop_up.title')}}",
                html: "{{__('inpanel.dashboard.pop_up.title_8')}}",
                type: "{{__('inpanel.dashboard.pop_up.title_5')}}",
                showCancelButton: true,
                confirmButtonColor: "#1080d0",
                confirmButtonText: "Yes, Update",
                cancelButtonText: "No",
                closeOnConfirm: true
            }).then((result) => {
                if (result.value===true) {
                    window.location.href = "detailed-profile?update=profile";
                } 
                else if(result.dismiss == 'cancel') {
                    @if($tour_taken == 0)
                    displayTourOption();
                    @include('inpanel.includes.partials.php-js.dashboard')
                    @endif
                }
            });
        }
		
		
        /*
            added code on 1 july 2022 via dushyant
            end
        */



        function closeTour()
        {
             expires=0;
             cvalue=1;
             cname="Tour";
             document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
            swal.close();
        }

        function changeTourOption()
        {
            var headers = {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            };
            var ajaxObj = axios.get("{{route('inpanel.change.tour.selection','dashboard')}}",headers);
        }

        $(document).on('click','a#survey',function (e) {
            var active_survey_id = $(this).attr('data-active_survey_id');
            console.log("tada");
            swal({
                title: ''+"<i class='fas fa-flag-checkered'></i>",
                html: "<strong>{{__('inpanel.dashboard.survey_pop_up.title_1')}}</strong>" +
                    "<br/>{{__('inpanel.dashboard.survey_pop_up.title_2')}}<br/>",
                type: "{{__('inpanel.dashboard.survey_pop_up.title_5')}}",
                showCancelButton: true,
                confirmButtonColor: "#1080d0",
                confirmButtonText: "{!! __('inpanel.dashboard.survey_pop_up.title_3') !!}",
                cancelButtonText: "{!! __('inpanel.dashboard.survey_pop_up.cancel') !!}",
                closeOnConfirm: false,
            }).then((result) => {
                if (result.value===true) {
                    var url = "{{route('inpanel.survey.execute.show',":id")}}";
                    url = url.replace(':id', active_survey_id);
                    window.location.replace(url);
                }
            });
        })

function invokeAPI() {
                var req = document.getElementById("requestid").value;
                var event = document.getElementById("eventid").value;
                var country = document.getElementById("cc").value;
                var utm_source="SjPanel";
                //$('#form-dispaly').hide();
               // $('.loader').show();
                var uniquenessParam = Forensic.createUniquenessParam(event,null, false);
                var geoParam = Forensic.createGeoParam(country);
                Forensic.forensic(req, successCallback, errorCallback, uniquenessParam, geoParam, null, null, utm_source);
            }
             function successCallback(jsonData) {
                var FlagStatus=false;
                var Message='';
                console.log(jsonData);
                var email=$('#email').val();
                var ip_address=$('#eventid').val();
                var panelistId=$('#eventid').val();
                var userid=$('#user_id').val();
                $.ajax({
                    url: "{{ route('inpanel.dashboard.dfiqData.post') }}",
                    type: 'GET',
                    data: {datajsondata:jsonData,email:email,ip_address:ip_address,panelistId:panelistId,user_id:userid},
                    success: function(response){
                       window.location=addressBar+"&DFIQ=true";
                    }, 
                    async: true
                    });
                if (jsonData.forensic.marker.score > 26 ||  jsonData.forensic.marker.isGeoPostal == true){
                    console.log("fraud score >= 25 or not unique"); // Add your logic to handle non-fraud/unique
                    if(jsonData.forensic.marker.isGeoPostal == false  && FlagStatus==false){
                       displayOtherCountryPopUp(); 
                    }
                    
                }
                
            };
            function errorCallback(jsonData) {
                console.log(jsonData.error.message); // Add your logic to handle errors
            }



                        // var spanish_fields = document.getElementById('tke_sry_but');

                        // if(spanish_fields.innerText != 'take surveys'){



                        //     spanish_fields.style.fontSize = '12px !important';
                        //   }


        // survey btn




var te = document.querySelectorAll('#tke_sry_but');




for(let i = 0; i < te.length; i++){




    if(te[i].innerText == 'Tomar encuestas'){

    te[i].style.fontSize = '13px';

    te[i].style.scale = '1.1';

}




}

var sa = document.getElementById("searchBarM");
var sj = document.getElementById("searchIconM");
sa.addEventListener("keyup", () => {
    if(sa.value !== ''){
        sj.style.visibility = 'hidden';
    }else{
        sj.style.visibility = 'visible';

    }

});



//






    </script>

@endpush
